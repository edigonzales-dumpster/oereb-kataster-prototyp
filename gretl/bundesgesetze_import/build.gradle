import ch.so.agi.gretl.tasks.*
import java.nio.file.Paths
import de.undercouch.gradle.tasks.download.Download

def pathToTempFolder = System.getProperty("java.io.tmpdir")
def pathToUnzipFolder = Paths.get(pathToTempFolder, "unzip_data")
def pathToDataZip = Paths.get(pathToTempFolder, "data.zip")
def fileName = "OeREBKRM_V1_1_Gesetze_20180501.xml"

def GROUP = "Bundesgesetze-Import"
 
task download(type: Download) {
    group = GROUP
    description = "Download Bundesgesetze."
    src "http://models.geo.admin.ch/V_D/OeREB/" + fileName
    dest pathToTempFolder
    overwrite true

    doLast {
        println "File downloaded to: " + pathToTempFolder
    }    
}
    
task dbImport(type: Ili2pgReplace, dependsOn: download) {
    group = GROUP
    description = "Import Bundesgesetze in die Datenbank."
    database = [dbUriOereb, dbUserOereb, dbPwdOereb]
    dbschema = dbSchema
    models = iliModelVorschriften
    dataFile = file(Paths.get(pathToTempFolder.toString(), fileName))
    dataset = "ch.admin.bk.gesetze"
    disableValidation = true

    doLast {
        println "Data imported into db: " + dbUriOereb
    }    
}