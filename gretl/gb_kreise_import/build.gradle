import ch.so.agi.gretl.tasks.*
import java.nio.file.Paths
import de.undercouch.gradle.tasks.download.Download

def pathToTempFolder = System.getProperty("java.io.tmpdir")
def fileName = "ch.so.agi.av.administrative_einteilungen.xtf"

def GROUP = "GB-Kreise-Import"
 
task download(type: Download) {
    group = GROUP
    description = "Download GB-Kreise."
    src "https://dl.bintray.com/sogis/ch.so.agi.oereb-data/" + fileName
    dest pathToTempFolder
    overwrite true

    doLast {
        println "File downloaded to: " + pathToTempFolder
    }    
}
    
task dbImport(type: Ili2pgReplace, dependsOn: download) {
    group = GROUP
    description = "Import GB-Kreise in die Datenbank."
    database = [dbUriOereb, dbUserOereb, dbPwdOereb]
    dbschema = dbSchema
    models = iliModelGrundbuchKreise
    dataFile = file(Paths.get(pathToTempFolder.toString(), fileName))
    dataset = fileName
    disableValidation = true

    doLast {
        println "Data imported into db: " + dbUriOereb
    }    
}